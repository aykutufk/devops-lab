# İş akışının adı
name: Deploy to EC2

# Tetikleyici: Bu iş akışı ne zaman çalışacak?
on:
  push:
    branches:
      - master  # Sadece 'master' dalına (branch) bir 'push' gelirse

# İşler: Hangi adımlar yapılacak?
jobs:
  deploy:
    # Hangi işletim sisteminde çalışacak? (GitHub'ın kendi sanal sunucusu)
    runs-on: ubuntu-latest

    # Adımlar
    steps:
      # 1. Adım: Sunucuya bağlanıp komutları çalıştıran bir aracı (action) indir
      - name: SSH and Run Commands
        uses: appleboy/ssh-action@v1.0.3
        
        # 2. Adım: O araca "sırları" ver
        with:
          host: ${{ secrets.EC2_HOST }}      # Ayarladığımız 'EC2_HOST' sırrı
          username: ${{ secrets.EC2_USER }}  # Ayarladığımız 'EC2_USER' sırrı
          key: ${{ secrets.EC2_SSH_KEY }}    # Ayarladığımız 'EC2_SSH_KEY' sırrı
          
          # 3. Adım: Sunucuda hangi komutları çalıştıracak?
          script: |
            echo "Baglanti basarili! Guncelleme basliyor..."
            cd /var/www/html
            git pull
            docker restart capstone-website
            echo "Guncelleme tamamlandi!"
